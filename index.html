<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Focus Rhythm - Smooth Audio Edition</title>
  <style>
    body {
      margin: 0;
      font-family: "Hiragino Sans", sans-serif;
      height: 100vh;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      background: linear-gradient(-45deg, #5C258D, #4389A2, #6a11cb, #2575fc);
      background-size: 400% 400%;
      animation: gradient 20s ease infinite;
    }

    @keyframes gradient {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    #particles {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(white 1px, transparent 1px);
      background-size: 3px 3px;
      opacity: 0.1;
      animation: stars 10s linear infinite;
      pointer-events: none;
    }

    @keyframes stars {
      from { transform: translateY(0); }
      to { transform: translateY(-100px); }
    }

    .card {
      position: relative;
      z-index: 2;
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(15px);
      border-radius: 20px;
      box-shadow: 0 0 30px rgba(0, 0, 0, 0.4);
      padding: 40px 60px;
      text-align: center;
      color: white;
      width: 320px;
      animation: fadeIn 2s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    h1 {
      font-size: 2em;
      margin-bottom: 15px;
      text-shadow: 0 0 10px rgba(255,255,255,0.6);
    }

    #timer {
      font-size: 3em;
      margin: 15px 0;
      text-shadow: 0 0 20px rgba(255,255,255,0.5);
    }

    #status {
      font-size: 1.3em;
      margin-bottom: 20px;
      color: #e0e0e0;
    }

    select, button {
      padding: 10px 20px;
      font-size: 1.1em;
      border: none;
      border-radius: 10px;
      background: rgba(255,255,255,0.2);
      color: white;
      cursor: pointer;
      margin: 5px;
      transition: all 0.3s ease;
    }

    select:hover, button:hover {
      background: rgba(255,255,255,0.5);
      box-shadow: 0 0 10px rgba(255,255,255,0.8);
    }
  </style>
</head>
<body>
  <div id="particles"></div>

  <div class="card">
    <h1>üéµ Focus Rhythm</h1>
    <div id="timer">25:00</div>
    <div id="status">ÈõÜ‰∏≠„Çø„Ç§„É†</div>

    <select id="bgmSelect">
      <option value="focus.mp3">Lo-FiÈõÜ‰∏≠</option>
      <option value="piano.mp3">„Éî„Ç¢„ÉéÈùôÈü≥</option>
      <option value="nature.mp3">Ëá™ÁÑ∂Èü≥</option>
    </select>

    <div>
      <button onclick="startTimer()">‚ñ∂ „Çπ„Çø„Éº„Éà</button>
      <button onclick="resetTimer()">‚èπ „É™„Çª„ÉÉ„Éà</button>
    </div>
  </div>

  <audio id="audio" loop></audio>

  <script>
    let totalSeconds = 25 * 60;
    let timer;
    let isBreak = false;
    const timerDisplay = document.getElementById("timer");
    const statusDisplay = document.getElementById("status");
    const audio = document.getElementById("audio");
    const bgmSelect = document.getElementById("bgmSelect");

    // üîä „Éï„Çß„Éº„ÉâÂà∂Âæ°
    function fadeOutAudio(audio, callback) {
      let fade = setInterval(() => {
        if (audio.volume > 0.05) {
          audio.volume -= 0.05;
        } else {
          audio.volume = 0;
          audio.pause();
          clearInterval(fade);
          if (callback) callback();
        }
      }, 100);
    }

    function fadeInAudio(audio) {
      audio.volume = 0;
      audio.play();
      let fade = setInterval(() => {
        if (audio.volume < 0.5) {
          audio.volume += 0.05;
        } else {
          audio.volume = 0.5;
          clearInterval(fade);
        }
      }, 100);
    }

    function startTimer() {
      clearInterval(timer);
      audio.src = "music/" + bgmSelect.value;
      fadeInAudio(audio);

      timer = setInterval(() => {
        totalSeconds--;
        const min = Math.floor(totalSeconds / 60);
        const sec = totalSeconds % 60;
        timerDisplay.textContent = `${String(min).padStart(2, '0')}:${String(sec).padStart(2, '0')}`;
        if (totalSeconds <= 0) changeMode();
      }, 1000);
    }

    function changeMode() {
      clearInterval(timer);
      fadeOutAudio(audio, () => {
        if (!isBreak) {
          isBreak = true;
          totalSeconds = 5 * 60;
          statusDisplay.textContent = "‚òï ‰ºëÊÜ©„Çø„Ç§„É†";
          document.body.style.background = "linear-gradient(-45deg, #00C9A7, #92FE9D, #43CEA2)";
        } else {
          isBreak = false;
          totalSeconds = 25 * 60;
          statusDisplay.textContent = "üéß ÈõÜ‰∏≠„Çø„Ç§„É†";
          document.body.style.background = "linear-gradient(-45deg, #5C258D, #4389A2, #6a11cb, #2575fc)";
        }
        document.body.style.backgroundSize = "400% 400%";
        document.body.style.animation = "gradient 20s ease infinite";
        fadeInAudio(audio);
        startTimer();
      });
    }

    function resetTimer() {
      clearInterval(timer);
      totalSeconds = 25 * 60;
      timerDisplay.textContent = "25:00";
      isBreak = false;
      statusDisplay.textContent = "ÈõÜ‰∏≠„Çø„Ç§„É†";
      document.body.style.background = "linear-gradient(-45deg, #5C258D, #4389A2, #6a11cb, #2575fc)";
      fadeOutAudio(audio);
    }
  </script>
</body>
</html>
